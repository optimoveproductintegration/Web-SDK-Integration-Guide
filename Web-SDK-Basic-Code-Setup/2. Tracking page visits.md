# Tracking page visits

## Step 1
In the trigger section of your Google Tag Manager account: 
* Create a custom trigger and name it "page_visit_trigger" 
* Set the Trigger Type to "Custom Event", 
* Set the Event name to "page_visit" 
* Set "This trigger fires on" to "All Custom Events".

<p align="left"><kbd><img src="https://github.com/optimove-tech/Web-SDK-Integration-Guide/blob/master/Web-SDK-Basic-Code-Setup/images/page_visit_trigger.png?raw=true"></kbd></p>

## Step 2
* Go back again to your "initialize_sdk_tag" and in the Custom HTML, add the following event using dataLayer.push():

```javascript
dataLayer.push({
      'event':"page_visit"
});
```
>**Note:**
This is a Google Tag Manager implementation that will cause the forthcoming "page_visit_tag" to be triggered on every page.

* The loadOptimoveSDKFunctions(status) function should now look like this:

<p align="left"><kbd><img src="https://github.com/DannyMac180/Web-SDK-Integration-Guide/blob/master/Web-SDK-Basic-Code-Setup/images/page_visit_event_3.png"></kbd></p>

## Step 3
In the Tag section of Google Tag Manager: 
* Create a new tag and name it "page_visit_tag" 
* Set the type to "Custom HTML" 
* Set the firing trigger to the "page_visit_trigger" that you created in the previous step

<p align="left"><kbd><img src="https://github.com/optimove-tech/Web-SDK-Integration-Guide/blob/master/Web-SDK-Basic-Code-Setup/images/page_visit_tag.png?raw=true"></kbd></p>

## Step 4
In the Variables section of Google Tag Manager:
* Create a variable named "page_category_var"
* Create a variable named "page_title_var"
* Create a variable named "page_url_var"

<p align="left"><kbd><img src="https://github.com/DannyMac180/Web-SDK-Integration-Guide/blob/master/Web-SDK-Basic-Code-Setup/images/gtm_variables.png"></kbd></p>

* For the "page_category_var", input this code:
```javascript
function() {
var metas = document.getElementsByTagName('meta'); 
      for (i=0; i<metas.length; i++) { 
            if (metas[i].getAttribute("property") == "og:category") { 
            return metas[i].getAttribute("content"); 
            } 
      }
}
```

* For the "page_title_var", input this code:
```javascript
function() {
var metas = document.getElementsByTagName('meta'); 
      for (i=0; i<metas.length; i++) { 
            if (metas[i].getAttribute("property") == "og:title") { 
            return metas[i].getAttribute("content"); 
            } 
      }
}
```

* For the "page_url_var", input this code:
```javascript
function() {
var metas = document.getElementsByTagName('meta'); 
      for (i=0; i<metas.length; i++) { 
            if (metas[i].getAttribute("property") == "og:url") { 
            return metas[i].getAttribute("content"); 
            } 
      }
}
```

>**Note:**
In this example, we are using meta tags to access the page data, for example url, title and category, but you should implement this according to the best way to access your page data.

## Step 5
* Open the custom HTML for the "page_visit_tag"
* In the custom HTML field for the "page_visit_tag":

<p align="left"><kbd><img src="https://github.com/DannyMac180/Web-SDK-Integration-Guide/blob/master/Web-SDK-Basic-Code-Setup/images/page_visit_tag_2.png"></kbd></p>

Input this code:

```javascript
<script>
optimoveSDK.API.setPageVisit({{page_url_var}}, {{page_title_var}}, {{page_category_var}});
</script>
```

## Step 6
* Save the "page_visit_tag" that you've just created
* Click the "Preview" button at the top right of GTM in order to check the changes on your site

<p align="left"><kbd><img src="https://github.com/optimove-tech/Web-SDK-Integration-Guide/blob/master/Web-SDK-Basic-Code-Setup/images/preview_screenshot_2.png?raw=true"><kbd></p>
